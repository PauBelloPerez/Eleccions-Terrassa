<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados Electorales</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.1.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Asegurar que la tabla tenga un tamaño fijo */
#resultsTable {
    width: 50%;
    table-layout: fixed; /* Distribución fija de las columnas */
}

/* Celdas de la tabla */
#resultsTable th, #resultsTable td {
    text-align: center; /* Centrar el contenido */
    vertical-align: middle; /* Centrar verticalmente */
    border: 1px solid #ddd; /* Agregar borde a las celdas */
    padding: 8px; /* Espacio alrededor del contenido */
    overflow: hidden; /* Ocultar desbordamiento */
    text-overflow: ellipsis; /* Agregar puntos suspensivos si el texto es muy largo */
}

/* Encabezado de la tabla */
#resultsTable th {
    background-color: #f2f2f2; /* Color de fondo del encabezado */
}

/* Celdas del cuerpo de la tabla */
#resultsTable td {
    height: 33px; /* Altura fija para las celdas */
}

/* Ajusta el contenedor de gráficos */
.charts {
    display: flex;
    flex-direction: column; /* Coloca los gráficos uno debajo del otro */
    align-items: center; /* Centra los gráficos horizontalmente */
}

/* Ajusta el tamaño de los gráficos */
#resultsChart, #resultsPieChart {
    width: 300px; /* Ajusta el ancho de los gráficos */
    height: 250px; /* Ajusta la altura de los gráficos */
}

/* Estilo para el botón y el iframe */
/* Estilo para el botón */
#mapButton {
    display: block; /* Asegura que el botón se comporte como un elemento de bloque */
    padding: 10px 20px;
    background-color: #007bff; /* Color de botón inicial */
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    position: absolute; /* Cambia a posición relativa */
    margin: 750px auto; /* Aumenta el margen superior para bajar el botón */
    z-index: 1000; /* Asegura que el botón esté encima del contenido */
}

/* Contenedor para el mapa */
#mapContainer {
    display: none; /* Oculta el iframe por defecto */
    width: 80%; /* Ajusta el ancho del iframe */
    margin: 20px auto; /* Espacio automático para centrar el contenedor y espacio adicional debajo del botón */
    padding-bottom: 20px; /* Espacio debajo del contenedor del mapa para evitar solapamiento con el contenido */
    position: absolute;
    margin: 800px auto;
    z-index: 1000; /* Cambia a posición relativa */
}

iframe {
    width: 100%;
    height: 600px;
    border: none;
}
    </style>
</head>
<body>
    <a href="index.html" id="backButton">Inici</a>
    <h1>Resultats Electorals</h1>
    <div class="filters">
        <label for="elecció">Elecció:</label>
        <select id="elecció">
            <option value="Municipals">Municipals</option>
            <option value="Parlament">Parlament</option>
            <option value="Generals">Generals</option>
            <option value="Europees">Europees</option>
        </select>

        <label for="any">Any:</label>
        <select id="any">
            <option value="2023">2023</option>
            <option value="2019">2019</option>
            <option value="2015">2015</option>
            <option value="2011">2011</option>
            <option value="2007">2007</option>
        </select>

        <label for="districte">Districte:</label>
        <select id="districte">
            <option value="tots">Tots</option>
        </select>

        <label for="seccio">Secció:</label>
        <select id="seccio">
            <option value="totes">Totes</option>
        </select>
    </div>
    <div class="content">
        <div class="main-content">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>Partit</th>
                        <th>Vots</th>
                        <th>% Vots</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las filas serán añadidas por JavaScript -->
                </tbody>
            </table>

            <div class="charts">
                <canvas id="resultsChart"></canvas>
                <canvas id="resultsPieChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Botón para ver el mapa, fuera del contenedor .content -->
    <button id="mapButton">Veure mapa</button>

    <!-- Contenedor para el iframe, fuera del contenedor .content -->
    <div id="mapContainer">
        <iframe id="mapIframe" src=""></iframe>
    </div>

    <script>
        document.getElementById('elecció').addEventListener('change', function() {
            const selection = this.value;
            if (selection === 'Generals') {
                window.location.href = 'SeleccionesGenerales2.html?eleccio=Generals';
            } else if (selection === 'Municipals') {
                window.location.href = 'Selecciones.html?eleccio=Municipals';
            }
            // Agrega más condiciones si tienes más elecciones y páginas HTML correspondientes
        });

        document.getElementById('any').addEventListener('change', function() {
            const year = this.value;
            const iframe = document.getElementById('mapIframe');
            let src = '';

            switch (year) {
                case '2023':
                    src = 'Elecciones Municipales 2023.html';
                    break;
                case '2019':
                    src = 'Municipals2019.html';
                    break;
                case '2015':
                    src = 'Municipals2015.html';
                    break;
                case '2011':
                    src = 'Municipals2011.html';
                    break;
                case '2007':
                    src = 'Municipals2007.html';
                    break;
                default:
                    src = '';
            }

            iframe.src = src;
        });

        // Set the selection value based on query parameter
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const eleccio = getQueryParam('eleccio');
        if (eleccio) {
            document.getElementById('elecció').value = eleccio;
        }

        // Mostrar el iframe al hacer clic en el botón
        document.getElementById('mapButton').addEventListener('click', function() {
            const mapContainer = document.getElementById('mapContainer');
            const button = document.getElementById('mapButton');
            const iframe = document.getElementById('mapIframe');

            // Asegúrate de que el iframe tenga una src válida
            if (iframe.src) {
                if (mapContainer.style.display === 'none' || mapContainer.style.display === '') {
                    mapContainer.style.display = 'block';
                    button.textContent = 'Tancar mapa'; // Cambia el texto del botón
                    button.style.backgroundColor = '#dc3545'; // Cambia el color del botón
                } else {
                    mapContainer.style.display = 'none';
                    button.textContent = 'Veure mapa'; // Cambia el texto del botón
                    button.style.backgroundColor = '#007bff'; // Cambia el color del botón
                }
            } else {
                alert('El iframe no tiene una fuente válida. Por favor, selecciona un año.');
            }
        });

        // Establece la fuente del iframe al cargar la página si se seleccionó un año
        document.addEventListener('DOMContentLoaded', function() {
            const year = document.getElementById('any').value;
            const iframe = document.getElementById('mapIframe');

            let src = '';

            switch (year) {
                case '2023':
                    src = 'Elecciones Municipales 2023.html';
                    break;
                case '2019':
                    src = 'Municipals2019.html';
                    break;
                case '2015':
                    src = 'Municipals2015.html';
                    break;
                case '2011':
                    src = 'Municipals2011.html';
                    break;
                case '2007':
                    src = 'Municipals2007.html';
                    break;
                default:
                    src = '';
            }

            iframe.src = src;
        });
    </script>
    <script src="script4.js"></script>
</body>
</html>
